<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger-gradient: linear-gradient(135deg, #ff7b7b 0%, #d63384 100%);
            --info-gradient: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .main-header {
            background: var(--primary-gradient);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-card {
            background: var(--primary-gradient);
            border: none;
            color: white;
            transition: all 0.3s ease;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .stats-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .payment-card {
            background: var(--warning-gradient);
            border: none;
            color: white;
        }
        
        .membership-card {
            background: var(--success-gradient);
            border: none;
            color: white;
        }
        
        .due-card {
            background: var(--danger-gradient);
            border: none;
            color: white;
        }
        
        .session-card {
            background: var(--info-gradient);
            border: none;
            color: white;
        }
        
        .status-active {
            background: var(--info-gradient);
        }
        
        .status-expired {
            background: var(--danger-gradient);
        }
        
        .status-partial {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
        }
        
        .profile-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .profile-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #007bff;
            box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        }
        
        .membership-item {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .membership-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-gradient);
        }

        .membership-item.active::before {
            background: var(--info-gradient);
        }

        .membership-item.expired::before {
            background: var(--danger-gradient);
        }

        .membership-item.partial::before {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
        }
        
        .membership-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .payment-progress {
            background: var(--info-gradient);
            border-radius: 10px;
            height: 12px;
        }

        .progress {
            border-radius: 10px;
            height: 12px;
            background: rgba(0,0,0,0.1);
        }
        
        .tab-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .nav-pills .nav-link {
            border-radius: 25px;
            margin-right: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-pills .nav-link.active {
            background: var(--primary-gradient);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .logout-btn {
            background: var(--danger-gradient);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
            color: white;
        }

        .membership-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-active {
            background: var(--info-gradient);
            color: white;
        }

        .badge-expired {
            background: var(--danger-gradient);
            color: white;
        }

        .badge-partial {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
            color: white;
        }

        .info-icon {
            color: #007bff;
            margin-right: 10px;
            width: 20px;
        }

        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="main-header fade-in">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-5 mb-2">
                        <i class="fas fa-dumbbell me-3"></i>Welcome back, {{ member.full_name }}!
                    </h1>
                    <p class="mb-0 fs-5 opacity-90">{{ gym.name }} Member Portal</p>
                </div>
                <div class="text-end">
                    <div class="mb-2">
                        <span class="membership-badge {% if membership_status == 'Active' %}badge-active{% elif membership_status == 'Expired' %}badge-expired{% else %}badge-partial{% endif %}">
                            {{ membership_status }}
                        </span>
                    </div>
                    <a href="{% url 'multiple_gym:logout' %}" class="btn logout-btn">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="row mb-5">
            <div class="col-md-2 mb-3">
                <div class="card stats-card text-center fade-in">
                    <div class="card-body py-4">
                        <i class="fas fa-calendar-days fa-3x mb-3 opacity-80"></i>
                        <h3 class="mb-2">{{ days_remaining|default:0 }}</h3>
                        <p class="mb-0 opacity-90">Days Remaining</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 mb-3">
                <div class="card payment-card text-center fade-in">
                    <div class="card-body py-4">
                        <i class="fas fa-rupee-sign fa-3x mb-3 opacity-80"></i>
                        <h3 class="mb-2">₹{{ total_paid|floatformat:0 }}</h3>
                        <p class="mb-0 opacity-90">Total Paid</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 mb-3">
                <div class="card due-card text-center fade-in">
                    <div class="card-body py-4">
                        <i class="fas fa-exclamation-circle fa-3x mb-3 opacity-80"></i>
                        <h3 class="mb-2">₹{{ total_due|floatformat:0 }}</h3>
                        <p class="mb-0 opacity-90">Amount Due</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 mb-3">
                <div class="card session-card text-center fade-in">
                    <div class="card-body py-4">
                        <i class="fas fa-dumbbell fa-3x mb-3 opacity-80"></i>
                        <h3 class="mb-2">{{ active_sessions_count }}</h3>
                        <p class="mb-0 opacity-90">Active Sessions</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 mb-3">
                <div class="card membership-card text-center fade-in">
                    <div class="card-body py-4">
                        <i class="fas fa-id-card fa-3x mb-3 opacity-80"></i>
                        <h3 class="mb-2">{{ total_memberships }}</h3>
                        <p class="mb-0 opacity-90">Total Plans</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 mb-3">
                <div class="card {% if membership_status == 'Active' %}status-active{% elif membership_status == 'Expired' %}status-expired{% else %}status-partial{% endif %} text-center fade-in">
                    <div class="card-body py-4">
                        <i class="fas fa-{% if membership_status == 'Active' %}check-circle{% elif membership_status == 'Expired' %}times-circle{% else %}clock{% endif %} fa-3x mb-3 opacity-80"></i>
                        <h5 class="mb-2">{{ membership_status }}</h5>
                        <p class="mb-0 opacity-90">Status</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Profile Section -->
            <div class="col-lg-4 mb-4">
                <div class="profile-section fade-in">
                    <div class="text-center mb-4">
                        {% if member.photo %}
                        <img src="{{ member.photo.url }}" class="profile-img mx-auto mb-3" alt="Profile Photo">
                        {% else %}
                        <div class="profile-img mx-auto mb-3 bg-light d-flex align-items-center justify-content-center">
                            <i class="fas fa-user fa-3x text-muted"></i>
                        </div>
                        {% endif %}
                        
                        <h3 class="text-primary mb-1">{{ member.full_name }}</h3>
                        <p class="text-muted mb-0">@{{ member.user.username }}</p>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-user me-2"></i>Personal Information
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <i class="fas fa-envelope info-icon"></i>{{ member.user.email }}
                            </div>
                            <div class="col-12">
                                <i class="fas fa-phone info-icon"></i>{{ member.phone }}
                            </div>
                            <div class="col-12">
                                <i class="fas fa-birthday-cake info-icon"></i>{{ member.date_of_birth|date:"M d, Y" }}
                            </div>
                            <div class="col-12">
                                <i class="fas fa-venus-mars info-icon"></i>{{ member.get_gender_display }}
                            </div>
                            {% if member.blood_group %}
                            <div class="col-12">
                                <i class="fas fa-tint info-icon"></i>{{ member.blood_group }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3 text-danger">
                            <i class="fas fa-phone-alt me-2"></i>Emergency Contact
                        </h5>
                        <div class="bg-light p-3 rounded">
                            <strong class="d-block">{{ member.emergency_contact_name }}</strong>
                            <span class="d-block"><i class="fas fa-phone text-danger me-2"></i>{{ member.emergency_contact_phone }}</span>
                            <small class="text-muted">{{ member.get_emergency_contact_relation_display }}</small>
                        </div>
                    </div>

                    <div>
                        <h5 class="mb-3 text-success">
                            <i class="fas fa-chart-line me-2"></i>Fitness Stats
                        </h5>
                        <div class="row text-center g-3">
                            <div class="col-6">
                                <div class="bg-light p-3 rounded">
                                    <h5 class="text-success mb-1">{{ attendance_rate }}%</h5>
                                    <small class="text-muted">Attendance</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="bg-light p-3 rounded">
                                    <h5 class="text-info mb-1">{{ attended_sessions }}</h5>
                                    <small class="text-muted">Sessions</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="bg-light p-3 rounded">
                                    <h5 class="text-warning mb-1">{{ current_weight }}kg</h5>
                                    <small class="text-muted">Weight</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="bg-light p-3 rounded">
                                    <h5 class="text-primary mb-1">{{ bmi }}</h5>
                                    <small class="text-muted">BMI</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabbed Content -->
            <div class="col-lg-8">
                <!-- Navigation Pills -->
                <ul class="nav nav-pills mb-4" id="dashboardTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="membership-tab" data-bs-toggle="pill" data-bs-target="#membership" type="button">
                            <i class="fas fa-id-badge me-2"></i>My Memberships
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="sessions-tab" data-bs-toggle="pill" data-bs-target="#sessions" type="button">
                            <i class="fas fa-dumbbell me-2"></i>Training Sessions
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="payments-tab" data-bs-toggle="pill" data-bs-target="#payments" type="button">
                            <i class="fas fa-credit-card me-2"></i>Payment History
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="dashboardTabsContent">
                    
                    <!-- Memberships Tab -->
                    <div class="tab-pane fade show active" id="membership" role="tabpanel">
                        
                        {% if memberships_with_data %}
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="text-primary mb-0">
                                    <i class="fas fa-list me-2"></i>All Your Memberships
                                </h4>
                                <span class="badge bg-primary fs-6">{{ total_memberships }} Total</span>
                            </div>
                            
                            <!-- Membership List -->
                            <div>
                                {% for item in memberships_with_data %}
                                <div class="membership-item {{ item.current_status }}">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <div>
                                                    <h5 class="mb-2 {% if item.membership.is_active %}text-success{% elif item.current_status == 'expired' %}text-danger{% else %}text-warning{% endif %}">
                                                        {{ item.membership.plan.name }}
                                                        {% if item.membership.is_active %}
                                                        <i class="fas fa-crown text-warning ms-2" title="Current Active Plan"></i>
                                                        {% endif %}
                                                    </h5>
                                                    <p class="text-muted mb-2">{{ item.membership.plan.description|default:"Premium gym membership" }}</p>
                                                    <div class="row g-2 text-sm">
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-play-circle me-1"></i>
                                                                <strong>Start:</strong> {{ item.membership.start_date|date:"M d, Y" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-stop-circle me-1"></i>
                                                                <strong>End:</strong> {{ item.membership.end_date|date:"M d, Y" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-clock me-1"></i>
                                                                <strong>Duration:</strong> {{ item.membership.plan.duration_months }} months
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            {% if item.membership.is_active and item.days_remaining > 0 %}
                                                            <small class="text-muted">
                                                                <i class="fas fa-calendar-check me-1"></i>
                                                                <strong>Days Left:</strong> 
                                                                <span class="text-success">{{ item.days_remaining }}</span>
                                                            </small>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Payment Progress -->
                                            <div class="mb-3">
                                                {% if item.membership.total_amount > 0 %}
                                                <div class="d-flex justify-content-between mb-2">
                                                    <small class="text-muted"><strong>Payment Progress:</strong></small>
                                                    <small class="fw-bold {% if item.payment_percentage == 100 %}text-success{% elif item.payment_percentage > 50 %}text-warning{% else %}text-danger{% endif %}">
                                                        ₹{{ item.membership.paid_amount|floatformat:0 }} / ₹{{ item.membership.total_amount|floatformat:0 }}
                                                        ({{ item.payment_percentage|floatformat:0 }}%)
                                                    </small>
                                                </div>
                                                <div class="progress mb-2" style="height: 8px;">
                                                    <div class="progress-bar {% if item.payment_percentage == 100 %}payment-progress{% elif item.payment_percentage > 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                                         role="progressbar" 
                                                         style="width: {{ item.payment_percentage }}%">
                                                    </div>
                                                </div>
                                                {% endif %}
                                                
                                                {% if item.membership.remaining_amount > 0 %}
                                                <small class="text-danger">
                                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                                    <strong>Outstanding:</strong> ₹{{ item.membership.remaining_amount|floatformat:0 }}
                                                </small>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-4 text-end">
                                            <div class="mb-3">
                                                <h4 class="text-primary mb-1">₹{{ item.membership.total_amount|floatformat:0 }}</h4>
                                                <small class="text-muted">Total Amount</small>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <span class="membership-badge {% if item.membership.payment_status == 'paid' %}badge-active{% elif item.membership.payment_status == 'partial' %}badge-partial{% else %}badge-expired{% endif %}">
                                                    {{ item.membership.get_payment_status_display }}
                                                </span>
                                            </div>
                                            
                                            <div>
                                                <span class="membership-badge {% if item.membership.membership_status == 'active' %}badge-active{% elif item.membership.membership_status == 'expired' %}badge-expired{% else %}badge-partial{% endif %}">
                                                    {{ item.membership.get_membership_status_display|title }}
                                                </span>
                                            </div>
                                            
                                            {% if item.membership.remaining_amount > 0 %}
                                            <div class="mt-3">
                                                <button class="btn btn-outline-primary btn-sm">
                                                    <i class="fas fa-credit-card me-1"></i>Pay Dues
                                                </button>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% else %}
                        <div class="alert alert-info border-0">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-info-circle fa-2x me-3 text-info"></i>
                                <div>
                                    <h5 class="text-info mb-1">No Memberships Found</h5>
                                    <p class="mb-0">You haven't purchased any membership plans yet. Contact gym administration to get started!</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Sessions Tab -->
                    <div class="tab-pane fade" id="sessions" role="tabpanel">
                        <h4 class="text-primary mb-4">
                            <i class="fas fa-dumbbell me-2"></i>My Training Sessions
                        </h4>
                        
                        <!-- Session Statistics -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card stats-card text-center">
                                    <div class="card-body py-3">
                                        <h5 class="mb-1">{{ total_sessions_enrolled }}</h5>
                                        <small>Total Enrolled</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card session-card text-center">
                                    <div class="card-body py-3">
                                        <h5 class="mb-1">{{ attended_sessions }}</h5>
                                        <small>Completed</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card membership-card text-center">
                                    <div class="card-body py-3">
                                        <h5 class="mb-1">{{ upcoming_sessions.count }}</h5>
                                        <small>Upcoming</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card due-card text-center">
                                    <div class="card-body py-3">
                                        <h5 class="mb-1">{{ missed_sessions }}</h5>
                                        <small>Missed</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Session Navigation Tabs -->
                        <ul class="nav nav-tabs mb-4" id="sessionTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="upcoming-sessions-tab" data-bs-toggle="tab" data-bs-target="#upcoming-sessions" type="button">
                                    <i class="fas fa-calendar-plus me-2"></i>Upcoming Sessions ({{ upcoming_sessions.count }})
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="past-sessions-tab" data-bs-toggle="tab" data-bs-target="#past-sessions" type="button">
                                    <i class="fas fa-history me-2"></i>Completed Sessions ({{ attended_sessions }})
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="missed-sessions-tab" data-bs-toggle="tab" data-bs-target="#missed-sessions" type="button">
                                    <i class="fas fa-times-circle me-2"></i>Missed Sessions ({{ missed_sessions }})
                                </button>
                            </li>
                        </ul>

                        <!-- Session Tab Content -->
                        <div class="tab-content" id="sessionTabsContent">
                            
                            <!-- Upcoming Sessions -->
                            <div class="tab-pane fade show active" id="upcoming-sessions" role="tabpanel">
                                {% if upcoming_sessions %}
                                    {% for participant in upcoming_sessions %}
                                    <div class="card mb-3 border-0 shadow-sm">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <h5 class="mb-0 me-3">{{ participant.session.title }}</h5>
                                                        {% if participant.session.is_zoom_session %}
                                                        <span class="badge bg-info">
                                                            <i class="fas fa-video me-1"></i>Online Session
                                                        </span>
                                                        {% endif %}
                                                        {% if participant.session.session_date == today %}
                                                        <span class="badge bg-warning text-dark ms-2">
                                                            <i class="fas fa-clock me-1"></i>Today
                                                        </span>
                                                        {% endif %}
                                                    </div>
                                                    
                                                    <p class="text-muted mb-2">{{ participant.session.description|truncatewords:20 }}</p>
                                                    
                                                    <div class="row g-2 mb-2">
                                                        <div class="col-md-4">
                                                            <small class="text-muted">
                                                                <i class="fas fa-calendar me-1"></i>
                                                                {{ participant.session.session_date|date:"D, M d, Y" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <small class="text-muted">
                                                                <i class="fas fa-clock me-1"></i>
                                                                {{ participant.session.start_time|time:"g:i A" }} - {{ participant.session.end_time|time:"g:i A" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <small class="text-muted">
                                                                <i class="fas fa-user me-1"></i>
                                                                {{ participant.session.trainer.full_name }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <small class="text-muted">
                                                                <i class="fas fa-map-marker-alt me-1"></i>
                                                                {{ participant.session.location|default:"Gym Floor" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <small class="text-muted">
                                                                <i class="fas fa-users me-1"></i>
                                                                {{ participant.session.participants_count }}/{{ participant.session.max_participants }} enrolled
                                                            </small>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <small class="text-muted">
                                                                <i class="fas fa-signal me-1"></i>
                                                                {{ participant.session.difficulty_level|title }}
                                                            </small>
                                                        </div>
                                                    </div>
                                                    
                                                    {% if participant.session.equipment_needed %}
                                                    <div class="mb-2">
                                                        <small class="text-muted">
                                                            <i class="fas fa-tools me-1"></i>
                                                            <strong>Equipment needed:</strong> {{ participant.session.equipment_needed }}
                                                        </small>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                
                                                <div class="col-md-4 text-end">
                                                    {% if participant.session.is_zoom_session %}
                                                    <div class="mb-2">
                                                        <a href="{{ participant.session.zoom_meeting_url }}" 
                                                           target="_blank" 
                                                           class="btn btn-success btn-sm">
                                                            <i class="fas fa-video me-1"></i>Join Zoom
                                                        </a>
                                                    </div>
                                                    <div class="mb-1">
                                                        <small class="text-muted d-block">
                                                            <strong>Meeting ID:</strong> {{ participant.session.zoom_meeting_id }}
                                                        </small>
                                                        {% if participant.session.zoom_meeting_password %}
                                                        <small class="text-muted d-block">
                                                            <strong>Password:</strong> {{ participant.session.zoom_meeting_password }}
                                                        </small>
                                                        {% endif %}
                                                    </div>
                                                    {% endif %}
                                                    
                                                    <div class="mt-2">
                                                        <span class="badge bg-primary">Enrolled</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                <div class="alert alert-info border-0">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-calendar-plus fa-2x me-3 text-info"></i>
                                        <div>
                                            <h5 class="text-info mb-1">No Upcoming Sessions</h5>
                                            <p class="mb-0">You don't have any upcoming training sessions. Check with your trainer to schedule new sessions!</p>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Past/Completed Sessions -->
                            <div class="tab-pane fade" id="past-sessions" role="tabpanel">
                                {% if recent_attendance %}
                                    {% for attendance in recent_attendance %}
                                    <div class="card mb-3 border-0 shadow-sm">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <h5 class="mb-0 me-3">{{ attendance.session.title }}</h5>
                                                        <span class="badge bg-success">
                                                            <i class="fas fa-check me-1"></i>Completed
                                                        </span>
                                                        {% if attendance.session.is_zoom_session %}
                                                        <span class="badge bg-info ms-2">
                                                            <i class="fas fa-video me-1"></i>Online Session
                                                        </span>
                                                        {% endif %}
                                                    </div>
                                                    
                                                    <p class="text-muted mb-2">{{ attendance.session.description|truncatewords:20 }}</p>
                                                    
                                                    <div class="row g-2 mb-2">
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-calendar me-1"></i>
                                                                {{ attendance.session.session_date|date:"D, M d, Y" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-clock me-1"></i>
                                                                {{ attendance.session.start_time|time:"g:i A" }} - {{ attendance.session.end_time|time:"g:i A" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-user me-1"></i>
                                                                {{ attendance.session.trainer.full_name }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-signal me-1"></i>
                                                                {{ attendance.session.difficulty_level|title }}
                                                            </small>
                                                        </div>
                                                    </div>
                                                    
                                                    {% if attendance.performance_rating %}
                                                    <div class="mb-2">
                                                        <small class="text-muted">
                                                            <i class="fas fa-star text-warning me-1"></i>
                                                            <strong>Your Rating:</strong> 
                                                            {% for i in "12345" %}
                                                                {% if forloop.counter <= attendance.performance_rating %}
                                                                <i class="fas fa-star text-warning"></i>
                                                                {% else %}
                                                                <i class="far fa-star text-muted"></i>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </small>
                                                    </div>
                                                    {% endif %}
                                                    
                                                    {% if attendance.trainer_notes %}
                                                    <div class="mb-2">
                                                        <small class="text-muted">
                                                            <i class="fas fa-sticky-note me-1"></i>
                                                            <strong>Trainer Notes:</strong> {{ attendance.trainer_notes|truncatewords:15 }}
                                                        </small>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                
                                                <div class="col-md-4 text-end">
                                                    <!-- Session Content -->
                                                    {% if attendance.session.content_materials.count > 0 %}
                                                    <div class="mb-2">
                                                        <h6 class="text-primary mb-2">
                                                            <i class="fas fa-folder me-1"></i>Session Materials
                                                        </h6>
                                                        {% for content in attendance.session.content_materials.all %}
                                                        <div class="mb-1">
                                                            {% if content.content_type == 'pdf' %}
                                                            <a href="{{ content.file.url }}" target="_blank" class="btn btn-outline-danger btn-sm">
                                                                <i class="fas fa-file-pdf me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% elif content.content_type == 'video' %}
                                                            <a href="{{ content.file.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
                                                                <i class="fas fa-play me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% elif content.content_type == 'youtube' %}
                                                            <a href="{{ content.youtube_url }}" target="_blank" class="btn btn-outline-danger btn-sm">
                                                                <i class="fab fa-youtube me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% elif content.content_type == 'link' %}
                                                            <a href="{{ content.external_url }}" target="_blank" class="btn btn-outline-info btn-sm">
                                                                <i class="fas fa-external-link-alt me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% else %}
                                                            <span class="btn btn-outline-secondary btn-sm">
                                                                <i class="fas fa-file me-1"></i>{{ content.title }}
                                                            </span>
                                                            {% endif %}
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                    {% endif %}
                                                    
                                                    <!-- Workout Plan -->
                                                    {% if attendance.session.workout_plan %}
                                                    <div class="mb-2">
                                                        <button class="btn btn-outline-success btn-sm" 
                                                                data-bs-toggle="collapse" 
                                                                data-bs-target="#workout-{{ attendance.session.id }}" 
                                                                aria-expanded="false">
                                                            <i class="fas fa-dumbbell me-1"></i>View Workout Plan
                                                        </button>
                                                    </div>
                                                    <div class="collapse mt-2" id="workout-{{ attendance.session.id }}">
                                                        <div class="card card-body bg-light">
                                                            <small>{{ attendance.session.workout_plan|linebreaks }}</small>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                <div class="alert alert-info border-0">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-check-circle fa-2x me-3 text-info"></i>
                                        <div>
                                            <h5 class="text-info mb-1">No Completed Sessions</h5>
                                            <p class="mb-0">You haven't completed any training sessions yet. Your session history will appear here once you start attending sessions!</p>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Missed Sessions Tab -->
                            <div class="tab-pane fade" id="missed-sessions" role="tabpanel">
                                {% if missed_sessions_list and missed_sessions_list|length > 0 %}
                                    {% for missed in missed_sessions_list %}
                                    <div class="card mb-3 border-0 shadow-sm border-start border-danger border-3">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <h5 class="mb-0 me-3">{{ missed.session.title }}</h5>
                                                        <span class="badge bg-danger">
                                                            <i class="fas fa-times me-1"></i>Missed
                                                        </span>
                                                        {% if missed.session.is_zoom_session %}
                                                        <span class="badge bg-secondary ms-2">
                                                            <i class="fas fa-video me-1"></i>Online Session
                                                        </span>
                                                        {% endif %}
                                                    </div>
                                                    
                                                    <p class="text-muted mb-2">{{ missed.session.description|truncatewords:20|default:"No description available" }}</p>
                                                    
                                                    <div class="row g-2 mb-2">
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-calendar me-1"></i>
                                                                {{ missed.session.session_date|date:"D, M d, Y" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-clock me-1"></i>
                                                                {{ missed.session.start_time|time:"g:i A" }} - {{ missed.session.end_time|time:"g:i A" }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-user me-1"></i>
                                                                {{ missed.session.trainer.full_name|default:missed.session.trainer.user.username }}
                                                            </small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <small class="text-muted">
                                                                <i class="fas fa-signal me-1"></i>
                                                                {{ missed.session.difficulty_level|title|default:"Beginner" }}
                                                            </small>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Reason for missing (if available) -->
                                                    {% if missed.member_feedback %}
                                                    <div class="mb-2">
                                                        <small class="text-muted">
                                                            <i class="fas fa-comment me-1"></i>
                                                            <strong>Note:</strong> {{ missed.member_feedback }}
                                                        </small>
                                                    </div>
                                                    {% endif %}
                                                    
                                                    {% if missed.trainer_notes %}
                                                    <div class="mb-2">
                                                        <small class="text-muted">
                                                            <i class="fas fa-sticky-note me-1"></i>
                                                            <strong>Trainer Note:</strong> {{ missed.trainer_notes|truncatewords:10 }}
                                                        </small>
                                                    </div>
                                                    {% endif %}
                                                    
                                                    <div class="alert alert-warning py-2 mb-2">
                                                        <small>
                                                            <i class="fas fa-info-circle me-1"></i>
                                                            You were enrolled but didn't attend this session. Try to maintain regular attendance for better results!
                                                        </small>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-md-4 text-end">
                                                    <!-- Show session content even for missed sessions -->
                                                    {% if missed.session.content_materials.exists %}
                                                    <div class="mb-2">
                                                        <h6 class="text-secondary mb-2">
                                                            <i class="fas fa-folder me-1"></i>Session Materials
                                                        </h6>
                                                        <small class="text-muted d-block mb-2">You can still access the materials from this session:</small>
                                                        {% for content in missed.session.content_materials.all %}
                                                        <div class="mb-1">
                                                            {% if content.content_type == 'pdf' %}
                                                            <a href="{{ content.file.url }}" target="_blank" class="btn btn-outline-danger btn-sm">
                                                                <i class="fas fa-file-pdf me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% elif content.content_type == 'video' %}
                                                            <a href="{{ content.file.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
                                                                <i class="fas fa-play me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% elif content.content_type == 'youtube' %}
                                                            <a href="{{ content.youtube_url }}" target="_blank" class="btn btn-outline-danger btn-sm">
                                                                <i class="fab fa-youtube me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% elif content.content_type == 'link' %}
                                                            <a href="{{ content.external_url }}" target="_blank" class="btn btn-outline-info btn-sm">
                                                                <i class="fas fa-external-link-alt me-1"></i>{{ content.title }}
                                                            </a>
                                                            {% else %}
                                                            <span class="btn btn-outline-secondary btn-sm">
                                                                <i class="fas fa-file me-1"></i>{{ content.title }}
                                                            </span>
                                                            {% endif %}
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                    {% endif %}
                                                    
                                                    <!-- Show workout plan for missed sessions too -->
                                                    {% if missed.session.workout_plan %}
                                                    <div class="mb-2">
                                                        <button class="btn btn-outline-warning btn-sm" 
                                                                data-bs-toggle="collapse" 
                                                                data-bs-target="#missed-workout-{{ missed.session.id }}" 
                                                                aria-expanded="false">
                                                            <i class="fas fa-dumbbell me-1"></i>View Workout Plan
                                                        </button>
                                                    </div>
                                                    <div class="collapse mt-2" id="missed-workout-{{ missed.session.id }}">
                                                        <div class="card card-body bg-light">
                                                            <small>{{ missed.session.workout_plan|linebreaks }}</small>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    
                                                    <!-- Makeup suggestion -->
                                                    <div class="mt-2">
                                                        <small class="text-muted">
                                                            <i class="fas fa-lightbulb me-1"></i>
                                                            Ask your trainer about makeup sessions!
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% elif missed_sessions > 0 %}
                                <div class="alert alert-warning border-0">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-exclamation-triangle fa-2x me-3 text-warning"></i>
                                        <div>
                                            <h5 class="text-warning mb-1">Missed Sessions Data Issue</h5>
                                            <p class="mb-0">You have {{ missed_sessions }} missed sessions, but detailed data is not available. Contact your trainer or gym admin.</p>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="alert alert-success border-0">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-thumbs-up fa-2x me-3 text-success"></i>
                                        <div>
                                            <h5 class="text-success mb-1">No Missed Sessions!</h5>
                                            <p class="mb-0">Excellent attendance record! You haven't missed any sessions that you were enrolled in. Keep up the great work!</p>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Payments Tab -->
                    <div class="tab-pane fade" id="payments" role="tabpanel">
                        <h4 class="text-primary mb-4">
                            <i class="fas fa-credit-card me-2"></i>Payment History
                        </h4>
                        
                        {% if recent_payments %}
                        <div class="mb-4">
                            {% for payment in recent_payments %}
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-4">
                                            <h6 class="mb-1">{{ payment.membership.plan.name }}</h6>
                                            <small class="text-muted">{{ payment.payment_date|date:"M d, Y" }}</small>
                                        </div>
                                        <div class="col-md-3">
                                            <small class="text-muted">
                                                <i class="fas fa-credit-card me-1"></i>
                                                {{ payment.get_payment_method_display|default:"Cash" }}
                                            </small>
                                        </div>
                                        <div class="col-md-3">
                                            <strong class="text-success">₹{{ payment.amount|floatformat:0 }}</strong>
                                        </div>
                                        <div class="col-md-2 text-end">
                                            <span class="badge bg-success">Paid</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="alert alert-info border-0">
                            <p class="mb-0">No payment history available.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        // Tab switching animation
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('#dashboardTabs button[data-bs-toggle="pill"]');
            
            tabs.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const targetPane = document.querySelector(e.target.getAttribute('data-bs-target'));
                    if (targetPane) {
                        targetPane.style.opacity = '0';
                        targetPane.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            targetPane.style.transition = 'all 0.3s ease';
                            targetPane.style.opacity = '1';
                            targetPane.style.transform = 'translateY(0)';
                        }, 50);
                    }
                });
            });

            // Enhanced hover effects
            document.querySelectorAll('.membership-item').forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>